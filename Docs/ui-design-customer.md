# UI/UX 設計書（顧客向け）

## 1. 画面一覧

### 1.1 顧客向け画面

#### 1.1.1 トップページ

- **目的**: ネイルショップの紹介と予約開始への導線
- **主要要素**:
  - ショップ情報
  - 「予約する」ボタン

#### 1.1.2 予約ページ（日付・メニュー選択）

- **目的**: 予約したい日付とメニューを選択
- **主要要素**:
  - カレンダー表示（週の始まりは月曜日）
  - 予約可能な日付の表示（営業日に設定された日付のみ）
  - 予約不可な日付の表示（グレーアウト、休日・定休日に設定された日付）
  - 未設定の日付は表示しない
  - **施術内容一覧**
    - 施術内容の概要（フォーマット済み）
    - 施術時間
    - 価格（円）
    - メニュー選択ボタン
  - **予約可能時間の表示**
    - 予約時刻＋施術時間で次の予約可能時間を算出して表示
    - 例：10:00 に 60 分の施術が予約されている場合、次の予約可能時間は 11:00 から
    - 例：13:00 に 90 分の施術が予約されている場合、次の予約可能時間は 14:30 から
    - 営業時間内で、既存予約と重複しない時間帯のみ予約可能として表示
    - 昼休憩時間中は予約不可として扱う（昼休憩時間を除外）
  - **期限表示**
    - 選択した日時から期限日時を計算して表示
    - 例：「キャンセル・変更期限：3/20 15:00 まで」（予約日時が 3/21 15:00、期限設定が 24 時間前の場合）
  - 「次へ」ボタン

#### 1.1.3 名前確認ページ（LINE Login 後）

- **目的**: LINE Login で認証済みのユーザーの名前を確認・編集
- **主要要素**:
  - LINE 表示名の表示（LINE Login から取得）
  - 名前入力フィールド（LINE 表示名を初期値として表示、編集可能）
  - 入力内容の説明文
  - 「次へ」ボタン

#### 1.1.5 予約確認ページ

- **目的**: 予約内容を確認して登録
- **主要要素**:
  - 選択した日付の表示
  - 予約時間の選択（必要に応じて）
  - カレンダーの週の始まりは月曜日
  - **選択した施術内容の表示**
    - 施術内容の概要（フォーマット済み）
    - 施術時間
    - 価格（円）
  - **期限表示**
    - 予約日時から期限日時を計算して表示
    - 例：「キャンセル・変更期限：3/20 15:00 まで」
  - 顧客情報の確認
    - 名前（LINE 表示名）
  - 「予約を確定する」ボタン
  - 「戻る」ボタン

#### 1.1.6 予約完了ページ

- **目的**: 予約登録完了を通知
- **主要要素**:
  - 予約完了メッセージ
  - 予約内容のサマリー表示
    - 予約日時
    - 施術内容の概要（フォーマット済み）
    - 施術時間
    - 価格（円）
  - 「予約一覧を見る」リンク（必要に応じて）
- **処理フロー**:
  - 「予約を確定する」ボタンクリック後、フロントエンドから Supabase DB に直接 CRUD 操作を実行
  - DB 保存後に Edge Function が自動的にトリガーされ、予約確認 LINE メッセージ（予約変更・キャンセル操作ボタン付き）を送信
  - トップページへのリンク

#### 1.1.7 予約キャンセルページ

- **目的**: LINE メッセージ内の予約変更・キャンセルボタンから予約をキャンセル
- **主要要素**:
  - 予約内容の表示
  - キャンセル確認メッセージ
  - キャンセル期限の表示（予約日時から期限日時を計算して表示）
    - 例：「キャンセル期限：3/20 15:00 まで」
  - **期限内の場合**
    - 「キャンセルする」ボタン
    - 「予約を変更する」リンク（予約変更ページへ遷移）
  - **期限超過の場合**
    - 「キャンセル期限を過ぎています」メッセージを表示
    - 「店に行けない」ボタン（期限超過後もキャンセル可能）
  - 「戻る」ボタン

**予約キャンセルの処理フロー**（期限内・期限超過どちらも同じ）

- キャンセル実行時（「キャンセルする」ボタン・「店に行けない」ボタンどちらも同じ）：
  1. LINE メッセージのボタン操作、または Web アプリから Supabase DB に直接 CRUD 操作を実行
  2. 予約情報を論理削除
  3. DB 保存後に Edge Function が自動的にトリガーされ、キャンセル完了の LINE メッセージ通知を送信
  4. LINE ユーザー ID 単位の予約キャンセル回数を +1（来店でリセット）

#### 1.1.8 予約変更ページ

- **目的**: LINE メッセージ内の予約変更・キャンセルボタンまたは予約キャンセルページから予約を変更
- **主要要素**:
  - 現在の予約内容の表示
  - 変更期限の表示（予約日時から期限日時を計算して表示）
    - 例：「変更期限：3/20 15:00 まで」
  - 期限超過時は「変更期限を過ぎています」メッセージを表示
  - **日時変更**
    - 日時選択
    - 予約済みの日時は選択不可
    - **予約可能時間の算出方法**
      - 予約時刻＋施術時間で次の予約可能時間を算出
      - 例：10:00 に 60 分の施術が予約されている場合、次の予約可能時間は 11:00 から
      - 例：13:00 に 90 分の施術が予約されている場合、次の予約可能時間は 14:30 から
      - 営業時間内で、既存予約と重複しない時間帯のみ予約可能として表示
      - 昼休憩時間中は予約不可として扱う（昼休憩時間を除外）
  - **施術内容変更**
    - 施術内容選択
    - 現在選択中の施術内容と予約済みの施術内容は選択不可
  - 「変更する」ボタン（期限内の場合のみ表示）
  - 「戻る」ボタン

**予約変更の処理フロー**

- 日時の変更でも施術内容の変更でも同じ処理フロー
  1. LINE メッセージのボタン操作、または Web アプリから Supabase DB に直接 CRUD 操作を実行
  2. 既存の予約情報を論理削除（変更のための内部処理。**予約キャンセル回数にはカウントしない**）
  3. 同じ LINE ユーザー ID であることを論理削除した予約情報と突合して確認
  4. 新たに予約情報を作成
  5. DB 保存後に Edge Function が自動的にトリガーされ、予約変更完了の LINE メッセージ通知を送信
  6. LINE ユーザー ID 単位の予約変更回数を +1（来店でリセット）

#### 1.1.9 補足：回数のリセット

- 予約キャンセル回数・予約変更回数は LINE ユーザー ID 単位で記録されます
- 来店後、スタッフが管理画面で「来店」ボタンを押したタイミングで回数がリセットされます

## 2. 画面遷移図

### 2.1 顧客向けフロー

```
LINEアプリ
  ↓（LINE Login）
トップページ
  ↓
予約ページ（日付選択）
  ↓
名前確認ページ（LINE表示名確認・編集）
  ↓
予約確認ページ
  ↓
予約完了ページ
```

### 2.2 予約キャンセル・予約変更フロー

```
LINEメッセージ内の予約変更・キャンセルボタン
  ↓
予約キャンセルページ
  ├→ 期限内 → 「キャンセルする」ボタン → Supabase DB直接CRUD（論理削除） → Edge Function自動トリガー → キャンセル完了LINEメッセージ送信
  ├→ 期限内 → 「予約を変更する」リンク → 予約変更ページ
  │   ├→ 期限超過 → 変更不可メッセージ
  │   └→ 期限内 → 日時・施術内容選択 → Supabase DB直接CRUD（既存予約論理削除→新規予約作成） → Edge Function自動トリガー → 変更完了LINEメッセージ送信
  └→ 期限超過 → 「店に行けない」ボタン → Supabase DB直接CRUD（論理削除） → Edge Function自動トリガー → キャンセル完了LINEメッセージ送信（期限内と同じ処理フロー）
```

## 3. UI/UX 要件

### 3.1 デザイン原則

- **シンプルで直感的な操作**: 予約フローを明確に
- **モバイルファースト**: スマートフォンでの利用を最優先（顧客向け）
- **アクセシビリティ**: 誰でも使いやすい UI

### 3.2 レスポンシブデザイン

- **顧客向け**: スマートフォン（主要）、タブレット

### 3.3 エラーハンドリング

- 入力エラーの明確な表示
- LINE Login 失敗時の再試行機能
- 予約不可日時の明確な表示

### 3.4 ローディング状態

- API 通信中のローディング表示
- LINE メッセージ送信中の状態表示

---

**作成日**: 2024 年
**バージョン**: 1.0
